---
title: 生产环境运维中遇到的问题和困惑(持续更新)
date: 2018-01-19 20:03:50
tags: 日常工作
---
# 遇到的困难和想到的解决办法
## 写在前面的话
### 我们不能避免发生故障，这世界上没有100%，发生故障后，第一我觉得也是最重要的，就是心态的平和，不论多少人催你多少人站在你身后，你要知道你自己做什么，总结一句话：”不要慌“。不要在发生故障时找故障原因，优先恢复业务，定位时间不要超过10分钟，实在发现不了问题，先重启，重启真的能解决95%以上的问题。既然公司的某些业务是自己负责的，你就是这方面的权威专家，你有权决定怎么干，强大的自信会让人心安。人要有担当，这是我做了3年sa的最重要的思想上的进步，有些事情总要有人去做，有些责任总要有人承担，事后追责是领导们的事情，我们最重要的是发生问题解决问题。


### 网络
- 私有网络在公司初期一定要规划好，并和公司的开发运维乃至公司高层达成共识，网络后期的割接是非常痛苦的，出现问题后也是灾难性的，且不好改动，我辈考虑不到3年以后5年以后公司的规模能够扩充到多大，但是这个为以后考虑的意识还是要有的，不同业务有不同得私有IP地址段，按照业务模式或业务线或不同部门规划清楚，比如Nginx此类的web服务器，比如openstack宿主机，这样发生网络故障影响线上业务时可以快速准确定位到哪个机柜哪个机房的交换机出现问题，
- 网络设备配置的备份，帐户名密码记录好，配置备份好，哪怕使用记事本，Excel这类的工具，自己首先要清楚知道每一台交换机的登陆用户名和密码。发生故障的时候真的没有时间让我们慢条斯理的查密码。
- 随着时间的推移，设备的老化并不是线性的，而是断崖式的，要做好心理准备，公司初期没有钱像BAT像金融业那样双上联交换机，大批量服务器让我们部署多套环境保证高可用，没有有异地灾备同城灾备的机房，这些都是现实，不过没关系，在现有的经济基础技术能力上做到最好就够了，当公司体量够大时，慢慢割接就好。无论你现在的情况是什么样的，保证一点，心中有数，知道哪里是单点。即使不是单点又能保证100%吗，也是不可能的，在能力范围内做到最好。
- 故障演练很重要，这个一定要做，想要知道苹果的味道你必须要咬一口，你怎么确定你做的高可用是可用的，用真正的故障去检测吗？真的等发生故障再发现所做的高可用不能用就晚了，领导会问你不是做了高可用了吗？钱都花了为什么没有产生应有的效果？怎样确定高可用是不是真的高可用呢？用实际效果来证明吧！定期的故障演练，及发生故障后的紧急预案都是必不可少的。

### 服务器，操作系统，运维自动化
- 主机名规范化，主机名一定要有意义，且所有服务器的字段要相同，每个字段都要有意义，比如说机房地址-机房名称-业务线名称（项目名称）-服务名称-编号，这样起主机名的好处一是方便故障处理，能够根据故障主机的主机名快速定位到相应的业务线，在硬件和系统都恢复之后，通知业务线的同事去恢复检查应用情况。二是方便成本的统计，公司想要盈利无非开源节流，开源这个我们运维就不要考虑了，但是节流是我们可以做，根据每个产品线每个项目的机器数量确定每个项目到底是盈利还是亏损，这时候标准化的主机名就会起到重大的作用，每个月快速准确的统计各个产品线项目的机器数量，做到成本可控，曾经经手过一个项目，前期大佬们说上亿的项目，做下来，你们项目高层能赚北京一套房，中层人员实施工程师能买辆车，一年过去了，发现仅是在基础设施投入上就基本将利润填平了，不要说项目过程中的人力资源成本。本来盈利的项目反而做亏了。所以成本统计真的很重要，接下来一个项目是好事，真正做到盈利是难事。当你目光脱离技术层面，上升到为整体运营成本考虑的时候，你的眼光已经足够高了，要记住技术只是手段，目的是为了公司的盈利。
- 业务逻辑驱动技术选型，调研一个新技术最好不要超过2周，如果发现不能落地就尽快放弃。现在的新技术层出不穷，研究调研一定要做，但是不是无限期的，最重要的原则是业务需要，再开始调研，接着再研究落地的可能。
- 鸡蛋永远不要放到一个篮子里，公有云不要选一个，服务器厂家不要选一个，网络设备不要选一个，所有的东西都不要选一家的，这样的绑定我经历过，结果很惨，你会被各种拿捏。
- 修改操作系统参数时，一定要经过多重验证，不然很容易崩。
- 运维都会有一个过程 运维无序化--->运维标准化--->运维自动化，最重要的也是最关键的一步个人觉得实在无序化到标准化的过程，这个过程是枯燥的繁琐的，要经过各种讨论乃至争吵，但是想要迈到自动化彻底脱离人肉运维，这些都是必须要做的。

