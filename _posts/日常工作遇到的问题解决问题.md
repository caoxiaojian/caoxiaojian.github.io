---
title: 工作中解决的问题
date: 2018-05-13 07:30:50
tags: 日常工作
---
## 制作opengstack镜像安装cloud-init后发现普通用户可以sudo -i到超级用户
   sudo visudo -f /etc/sudoers.d/90-cloud-init-users删除里边的所有内容

## openstack 虚拟机修改主机名的方式,因为虚拟机在启动时，就把服务器的主机名注入到了metedate里，在系统层面修改，需要这样操作
1. hostnamectl set-hostname new_hostname
2. vim /etc/cloud/cloud.cfg这两项前面加上注释，然后service cloud-init restart
   - set_hostname
   - update_hostname

## 查看/var/log/memsage时发现报错kernel: i40e 0000:01:00.1: TX driver issue detected, PF reset issued 网卡在不断的reset
  ethtool -K ethX tso off gso off

## 安装java1.8
rpm -ivh jdk-8u66-linux-x64.rpm
hadoop用户修改/home/hadoop/.bash_profile
export JAVA_HOME=/usr/java/jdk1.8.0_66
export PATH=$JAVA_HOME/bin:$PATH

## $PATH改错之后的补救措施
环境变量设错之后 所有命令不能使用，补救措施：export PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin

## 升级python后导致yum不能使用
CentOS 6只要修改/usr/bin/yum 
CentOS 7需要同时修改/usr/bin/yum以及/usr/libexec/urlgrabber-ext-down同样的Python版本 
#!/usr/bin/python 
修改为： 
#!/usr/bin/python2.7

## 登陆shell时报错-bash: fork: Cannot allocate memory
echo "kernel.pid_max=1000000 " >> /etc/sysctl.conf

## 普通用户编译安装nginx后想要普通用户可以占用80端口启动nginx需要执行的命令
setcap cap_net_bind_service=+ep /home/hadoop/nginx/sbin/nginx

## myuser使用mypassword从任何主机连接到mysql服务器
GRANT ALL PRIVILEGES ON *.* TO 'myuser'@'%' IDENTIFIED BY 'mypassword' WITH GRANT OPTION;
FLUSH   PRIVILEGES;

## 更改mysql密码
update mysql.user set authentication_string=password('123qwe') where user='root' and Host = 'localhost';

## 忘记mysql密码
1.Kill mysql
2.vim /usr/local/mysql3306/etc/my.cnf  在【mysqld】下加 skip-grant-tables
3.启动mysql
4.mysql -u root
5.update mysql.user set authentication_string=password('新密码') where user='root';
6.flush privileges;
7.kill mysql
8.去掉参数skip-grant-tables，重启mysql
9.使用新密码登陆

## 解决Docker build时 Sending build context to Docker daemon 过大的问题
Docker Client会默认发送Dockerfile同级目录下的所有文件到Dockerdaemon中.
解决办法有两种：
1.创建.dockerignore文件，把不需要的文件写到里面，该文件包含的目录不会被发送到Docker daemon中
2.就找个空目录只有dockerfile


## 安装nodejs
* curl --silent --location https://rpm.nodesource.com/setup_8.x | sudo bash -
* curl --silent --location https://rpm.nodesource.com/setup_9.x | sudo bash -
* curl --silent --location https://rpm.nodesource.com/setup_10.x | sudo bash -
  https://nodejs.org/en/download/package-manager/
